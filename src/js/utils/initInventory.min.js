import $ from"jquery";import languageES from"datatables.net-plugins/i18n/es-ES.mjs";const Swal=window.Swal;export function initInventory(data,title,periodText){$("#inventoryTable").DataTable({order:[],responsive:!0,pageLength:10,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Todos"]],language:{...languageES,lengthMenu:"_MENU_ por página",searchPlaceholder:"Buscar..."},buttons:[{extend:"pdfHtml5",text:'<i class="fa fa-file-pdf-o"></i> Exportar PDF',titleAttr:"Exportar a PDF",className:"btn-export btn-pdf",exportOptions:{columns:":visible"},orientation:"landscape",pageSize:"LEGAL",title:`${title} - ${periodText}`,action:function(e,dt,button,config){Swal.fire({title:"Generando PDF...",text:"Por favor espere...",allowOutsideClick:!1,didOpen:()=>{Swal.showLoading()}});setTimeout((()=>{try{const exportData=dt.buttons.exportData(config.exportOptions),title=document.title.split("|")[0].trim(),docDefinition={pageSize:"LEGAL",pageOrientation:"landscape",content:[{text:document.title.split("|")[1].trim(),style:"header"},{text:title,style:"subtitle"},{text:periodText,style:"subHeaderRow"},{margin:[0,10,0,10],stack:[{columns:[{text:`RFC: ${document.getElementById("rfc")?.textContent||""}`,fontSize:10,width:"50%"},{text:`IMMEX: ${document.getElementById("immex")?.textContent||""}`,fontSize:10,width:"50%"}]},{text:`Domicilio fiscal: ${document.getElementById("financialAddr")?.textContent||""}`,fontSize:10,margin:[0,5,0,0]}]},{table:{headerRows:1,widths:Array(exportData.header.length).fill("auto"),body:[exportData.header,...exportData.body]},layout:{hLineWidth:()=>.5,vLineWidth:()=>.5,hLineColor:()=>"#aaa",vLineColor:()=>"#aaa",fillColor:i=>i%2==0?"#f8f8f8":null}},{text:"Leyenda de errores de existencia o costos:",style:"subheader",margin:[0,15,0,5]},{table:{headerRows:0,widths:["3%","97%"],body:data.data.notes.map((note=>{const match=note.match(/^\((\d+)\)\s*(.*)/);return match?[{text:match[1],alignment:"center",bold:!0},{text:match[2].trim()}]:[{text:"",alignment:"center"},note]}))},layout:{hLineWidth:function(){return 0},vLineWidth:function(){return 0},hLineColor:function(){return"#aaaaaa"},vLineColor:function(){return"#aaaaaa"},paddingLeft:function(){return 5},paddingRight:function(){return 5},paddingTop:function(){return 3},paddingBottom:function(){return 3}},style:"errorTable",margin:[0,0,0,10]}],styles:{header:{fontSize:14,bold:!0,margin:[0,0,0,10],alignment:"center"},subtitle:{fontSize:12,bold:!0,margin:[0,0,0,10],alignment:"center"},subHeaderRow:{fontSize:10,bold:!0,margin:[0,0,0,10],alignment:"center"},tableHeader:{fontSize:10,bold:!0,alignment:"center"},errorTable:{fontSize:9,margin:[0,5,0,15]}},defaultStyle:{fontSize:9}};(()=>{window.pdfMake?window.pdfMake.createPdf(docDefinition).download(`${title} - ${periodText}.pdf`):(console.error("pdfMake is not available. Check your CDN imports."),Swal.fire({title:"Error",text:"No se pudo generar el PDF: pdfMake no está disponible",icon:"error"}))})(),setTimeout((()=>{Swal.fire({title:"PDF Generado",text:"El documento ha sido generado exitosamente",icon:"success",timer:2e3,timerProgressBar:!0})}),500)}catch(error){console.error("Error generating PDF:",error),Swal.fire({title:"Error",text:"No se pudo generar el PDF",icon:"error"})}}),300)}}],dom:'<"datatable-header"<"left"l><"center"B><"right"f>>rt<"datatable-footer"<"pagination-wrapper"<"pagination-info"i><"pagination-controls"p>>>',scrollX:!1,fixedHeader:!0,paging:!0,autoWidth:!1,columnDefs:[{width:"25%",target:1},{width:"6%",target:2},{width:"3%",target:11}]})}